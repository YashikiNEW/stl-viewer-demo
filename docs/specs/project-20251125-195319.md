# STL 3Dビューア 仕様書

**作成日**: 2025-11-25
**バージョン**: 1.0

---

## 1. 概要

STLファイルをアップロードしてブラウザ上で3Dモデルを表示・操作できるWebアプリケーション。ユーザーはドラッグ&ドロップまたはファイル選択でSTLファイルを読み込み、回転・ズーム・パン操作で3Dモデルを確認できる。

---

## 2. 目的とスコープ

### 2.1 目的

- STLファイルの内容を視覚的に確認できる環境を提供する
- 3Dモデルの基本情報（頂点数、面数、サイズ）を把握できるようにする
- 複数モデルの比較を容易にする

### 2.2 スコープ内

- STLファイルのアップロードと3D表示
- モデルの回転・ズーム・パン操作
- モデル情報の表示（頂点数、面数、バウンディングボックス）
- 表示設定の変更（色、マテリアル、ワイヤーフレーム）
- 複数モデルの並列比較表示
- スクリーンショット保存

### 2.3 スコープ外

- バックエンドサーバー（フロントエンドのみで完結）
- STL以外の3Dフォーマット対応（OBJ, PLY, GLTF等）
- ユーザー認証・データ永続化
- モデルの編集機能
- モデルのエクスポート機能

---

## 3. 機能要件

### 3.1 STLファイルアップロード

| 項目 | 内容 |
|------|------|
| 機能ID | F-001 |
| 概要 | ユーザーがSTLファイルをアップロードする |
| 入力方法 | ドラッグ&ドロップ、またはファイル選択ダイアログ |
| 対応形式 | STLバイナリ形式、STL ASCII形式 |
| ファイルサイズ | 制限なし |
| 複数ファイル | 比較モード用に最大2ファイルまで |

**受け入れ条件**:
- ドラッグ&ドロップでSTLファイルを読み込める
- ファイル選択ボタンからSTLファイルを読み込める
- バイナリ形式のSTLが正しく読み込める
- ASCII形式のSTLが正しく読み込める

### 3.2 3Dモデル表示

| 項目 | 内容 |
|------|------|
| 機能ID | F-002 |
| 概要 | アップロードされたSTLを3Dで表示する |
| 操作 | 回転（ドラッグ）、ズーム（スクロール）、パン（右ドラッグ/Shift+ドラッグ） |
| 初期表示 | モデル全体が見える位置にカメラを自動調整 |
| ライティング | 環境光 + 指向性ライト |

**受け入れ条件**:
- STLモデルが3D空間に正しく表示される
- マウスドラッグでモデルを回転できる
- マウスホイールでズームイン/アウトできる
- 右ドラッグまたはShift+ドラッグでパン操作できる
- モデル読み込み時に全体が見える位置にカメラが調整される

### 3.3 モデル情報表示

| 項目 | 内容 |
|------|------|
| 機能ID | F-003 |
| 概要 | 読み込んだモデルのメタ情報を表示する |
| 表示項目 | 頂点数、面（三角形）数、バウンディングボックスサイズ（X, Y, Z） |
| 表示位置 | サイドパネル |

**受け入れ条件**:
- 頂点数が正しく表示される
- 面数（三角形数）が正しく表示される
- バウンディングボックスのX, Y, Zサイズが表示される
- 単位はSTLファイルの単位系に依存（単位表示なし）

### 3.4 表示設定変更

| 項目 | 内容 |
|------|------|
| 機能ID | F-004 |
| 概要 | モデルの表示スタイルを変更する |
| 設定項目 | モデル色、ワイヤーフレーム表示ON/OFF |
| デフォルト | 色: グレー (#808080)、ワイヤーフレーム: OFF |

**受け入れ条件**:
- カラーピッカーでモデルの色を変更できる
- ワイヤーフレーム表示のON/OFFを切り替えられる
- 設定変更が即座に反映される

### 3.5 複数モデル比較

| 項目 | 内容 |
|------|------|
| 機能ID | F-005 |
| 概要 | 2つのSTLモデルを並べて比較表示する |
| レイアウト | 画面を左右に分割して表示 |
| 操作 | 各ビューは独立して操作可能 |
| 同期 | なし（独立操作） |

**受け入れ条件**:
- 比較モードに切り替えられる
- 2つのSTLファイルをそれぞれ読み込める
- 左右に分割された画面で2つのモデルが表示される
- 各ビューのカメラ操作は独立している

### 3.6 スクリーンショット保存

| 項目 | 内容 |
|------|------|
| 機能ID | F-006 |
| 概要 | 現在の3Dビューを画像として保存する |
| 形式 | PNG |
| ファイル名 | `stl-screenshot-{timestamp}.png` |

**受け入れ条件**:
- スクリーンショットボタンをクリックすると画像がダウンロードされる
- 現在のカメラアングルでの表示が画像として保存される
- PNG形式で保存される

### 3.7 エラー処理

| 項目 | 内容 |
|------|------|
| 機能ID | F-007 |
| 概要 | 不正なファイルに対するエラー表示 |
| 対象 | 破損STL、非対応形式、読み込み失敗 |
| 表示 | エラーメッセージ + 再アップロードを促すUI |

**受け入れ条件**:
- 不正なファイルを読み込んだ際にエラーメッセージが表示される
- エラー状態から再度ファイルをアップロードできる
- エラーメッセージは具体的で分かりやすい

---

## 4. 非機能要件

### 4.1 パフォーマンス

- 10MB以下のSTLファイルは3秒以内に表示開始
- 60fpsでの描画を目標（モデルサイズによる）

### 4.2 ブラウザ対応

- Chrome（最新版）
- Firefox（最新版）
- Safari（最新版）
- Edge（最新版）

### 4.3 レスポンシブ対応

- デスクトップ（1024px以上）を主対象
- タブレット・モバイルは考慮しない

### 4.4 拡張性

- 機能追加が容易なモジュール設計
- コンポーネントは単一責任原則に従う
- 3Dビューア部分は再利用可能なコンポーネントとして設計

---

## 5. 技術的制約

### 5.1 技術スタック

| 項目 | 技術 |
|------|------|
| 言語 | TypeScript |
| フレームワーク | React 18+ |
| 3Dライブラリ | Three.js (React Three Fiber, @react-three/drei) |
| ビルドツール | Vite |
| スタイリング | CSS Modules または Tailwind CSS |

### 5.2 ディレクトリ構成

```
src/
├── components/          # UIコンポーネント
│   ├── viewer/          # 3Dビューア関連
│   ├── sidebar/         # サイドパネル関連
│   └── common/          # 共通コンポーネント
├── hooks/               # カスタムフック
├── utils/               # ユーティリティ関数
├── types/               # 型定義
└── App.tsx              # メインアプリ
```

### 5.3 依存ライブラリ

- `three`: Three.js本体
- `@react-three/fiber`: React用Three.jsバインディング
- `@react-three/drei`: Three.js用ヘルパーコンポーネント
- `three/examples/jsm/loaders/STLLoader`: STL読み込み

---

## 6. UI設計

### 6.1 レイアウト

```
┌─────────────────────────────────────────────────────┐
│  ヘッダー                                           │
│  [STL 3D Viewer]              [アップロード] [比較] │
├───────────────────────────────┬─────────────────────┤
│                               │ サイドパネル        │
│                               │                     │
│   3Dビューア                  │ ▼ モデル情報        │
│   (Canvas)                    │   頂点数: xxx       │
│                               │   面数: xxx         │
│                               │   サイズ: x,y,z     │
│                               │                     │
│                               │ ▼ 表示設定          │
│                               │   色: [____]        │
│                               │   □ ワイヤーフレーム│
│                               │                     │
│                               │ [スクリーンショット]│
├───────────────────────────────┴─────────────────────┤
│  ドラッグ&ドロップエリア（ファイル未選択時）        │
└─────────────────────────────────────────────────────┘
```

### 6.2 比較モード時レイアウト

```
┌─────────────────────────────────────────────────────┐
│  ヘッダー                              [比較終了]   │
├────────────────────────┬────────────────────────────┤
│                        │                            │
│   ビューア1            │   ビューア2                │
│   [アップロード1]      │   [アップロード2]          │
│                        │                            │
└────────────────────────┴────────────────────────────┘
```

---

## 7. 実装タスク（大まかな分割）

### Phase 1: 基盤構築
1. プロジェクトセットアップ（Vite + React + TypeScript）
2. Three.js / React Three Fiber環境構築
3. 基本レイアウト実装（ヘッダー、メイン、サイドパネル）

### Phase 2: コア機能
4. STLファイルアップロード機能
5. STLローダー実装（バイナリ/ASCII対応）
6. 3Dビューア実装（表示、カメラコントロール）
7. エラーハンドリング実装

### Phase 3: 情報表示・設定
8. モデル情報表示（頂点数、面数、バウンディングボックス）
9. 表示設定UI（色変更、ワイヤーフレーム）

### Phase 4: 追加機能
10. 複数モデル比較機能
11. スクリーンショット保存機能

### Phase 5: 仕上げ
12. UIブラッシュアップ
13. テスト・バグ修正

---

## 8. 成功基準

- [ ] STLファイル（バイナリ/ASCII）が正しく3D表示される
- [ ] 回転・ズーム・パン操作が動作する
- [ ] モデル情報（頂点数、面数、サイズ）が表示される
- [ ] 色変更・ワイヤーフレーム切替が動作する
- [ ] 2つのモデルを並べて比較表示できる
- [ ] スクリーンショットがPNGでダウンロードできる
- [ ] エラー時に適切なメッセージが表示され、再アップロードできる
